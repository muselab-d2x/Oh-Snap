- name: Send Slack DM
  if: success()
  env:
    SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
    ORG: ${{ inputs.org }}
    SLACK_USERNAME: ${{ inputs.slack_username }}
  run: |
    set -e
    login_url=$(cat login_url.txt)
    echo "login_url=$login_url" >> $GITHUB_OUTPUT

    CHANNEL="@${SLACK_USERNAME:-'jasonlantz'}"
    TEXT="Here is your Salesforce login URL for ${ORG}: ${login_url}"

    # Construct JSON data safely
    JSON_DATA=$(jq -n \
      --arg channel "$CHANNEL" \
      --arg text "$TEXT" \
      '{channel: $channel, text: $text}')

    response=$(curl -X POST -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
         -H "Content-Type: application/json" \
         -d "$JSON_DATA" \
         https://slack.com/api/chat.postMessage)
    rm login_url.txt
    echo "Slack API response: $response"
    if [[ $response != *'"ok":true'* ]]; then
      echo "Error: Failed to send Slack DM"
      exit 1
    fi

